const amqp=require('amqplib');
const queue="hello";
const PREFETCH_COUNT=5 //message fetched per consumer
async function startConsumer(){
   const connection=await amqp.connect("amqps://bdufsvea:bfblus1mHqeblmPWt-F7lcI1FkgWgj45@sparrow.rmq.cloudamqp.com/bdufsvea");
       const channel=await connection.createChannel();
       await channel.assertQueue(queue,{durable:true});
       channel.prefetch(PREFETCH_COUNT  )
 
       console.log(`consumer started`);
    channel.consume(queue,(msg)=>{
        if(msg!==null){
            console.log(`consumer ${id} processing ${msg.content.toString()}`)
            setTimeout(()=>{
                channel.ack(msg);
                console.log(`Message Processed`)
            },1000);
        }
    })
}
 
startConsumer().catch(console.error)
