const amqp = require('amqplib');
const queue = 'Hello';
const CONSUMER_COUNT = 5;
 
async function createConsumer(id) {
    const connection = await amqp.connect("amqps://bdufsvea:bfblus1mHqeblmPWt-F7lcI1FkgWgj45@sparrow.rmq.cloudamqp.com/bdufsvea");
    const channel = await connection.createChannel();
    await channel.assertQueue(queue, { durable: true });
    console.log(`Consumer ${id} Started`);
    channel.consume(queue, (msg) => {
        if (msg != null) {
            console.log(`Consumer ${id} Processing ${msg.content.toString()}`);
            setTimeout(() => {
                channel.ack(msg);
                console.log(`Consumer ${id} is Done`);
            }), 1000;
        }
    })
 
}
 
async function startConsumer() {
    for (let i = 1; i < CONSUMER_COUNT; i++) {
        createConsumer(i).catch(console.error)
    }
}
startConsumer();
